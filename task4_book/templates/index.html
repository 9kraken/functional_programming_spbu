<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–Ω–∏–≥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —Ñ–æ—Ä–º–∞ */
        .form-panel {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .form-panel h2 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95em;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group select {
            cursor: pointer;
        }

        .form-control-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 0.85em;
        }

        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã */
        .results-panel {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            min-height: 600px;
        }

        .results-panel h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
        }

        .preference-summary {
            background: #f8f9ff;
            padding: 15px;
            border-left: 4px solid #667eea;
            border-radius: 4px;
            margin-bottom: 20px;
            color: #666;
            font-size: 0.95em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-left: 4px solid #c62828;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .success-message {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-left: 4px solid #2e7d32;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        /* –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π */
        .recommendations-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .recommendations-table thead {
            background: #f5f5f5;
            color: #333;
        }

        .recommendations-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #ddd;
        }

        .recommendations-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .recommendations-table tbody tr {
            transition: background 0.2s ease;
        }

        .recommendations-table tbody tr:hover {
            background: #f9f9f9;
        }

        .book-title {
            color: #667eea;
            font-weight: 600;
        }

        .score {
            font-weight: 600;
            color: #4caf50;
        }

        .year {
            color: #999;
        }

        .genre-badge {
            display: inline-block;
            background: #e0e7ff;
            color: #667eea;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .keywords {
            font-size: 0.85em;
            color: #999;
        }

        .reading-list-btn {
            background: #ff9800;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .reading-list-btn:hover {
            background: #f57c00;
        }

        .reading-list-btn.added {
            background: #4caf50;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .no-results-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .sort-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .sort-btn {
            background: #f0f0f0;
            padding: 8px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .sort-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .sort-btn:hover {
            border-color: #667eea;
        }

        .stats {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            text-align: center;
        }

        .stat-item {
            font-size: 0.9em;
        }

        .stat-value {
            font-weight: 600;
            color: #667eea;
            font-size: 1.2em;
        }

        .stat-label {
            color: #999;
            font-size: 0.85em;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        footer {
            text-align: center;
            color: white;
            padding: 30px;
            opacity: 0.8;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <header>
            <h1>üìö –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–Ω–∏–≥</h1>
            <p>–ù–∞–π–¥–∏—Ç–µ –∫–Ω–∏–≥—É –≤–∞—à–µ–π –º–µ—á—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π</p>
        </header>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: —Ñ–æ—Ä–º–∞ -->
            <div class="form-panel">
                <h2>–í–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</h2>

                <form id="preferencesForm">
                    <div class="form-group">
                        <label for="genres">–õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã <small>(—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</small></label>
                        <input type="text" id="genres" name="genres" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞, –¥–µ—Ç–µ–∫—Ç–∏–≤">
                    </div>

                    <div class="form-group">
                        <label for="authors">–õ—é–±–∏–º—ã–µ –∞–≤—Ç–æ—Ä—ã <small>(—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</small></label>
                        <input type="text" id="authors" name="authors" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–∑–∏–º–æ–≤, –¢–æ–ª—Å—Ç–æ–π">
                    </div>

                    <div class="form-group">
                        <label for="keywords">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ <small>(—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</small></label>
                        <input type="text" id="keywords" name="keywords" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è, –ª—é–±–æ–≤—å">
                    </div>

                    <div class="form-group">
                        <label for="minYear">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≥–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
                        <input type="number" id="minYear" name="min_year" min="0" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1950">
                    </div>

                    <div class="form-group">
                        <label for="sortBy">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</label>
                        <select id="sortBy" name="sort_by">
                            <option value="score">–ü–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏</option>
                            <option value="title">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (A-Z)</option>
                            <option value="year">–ü–æ –≥–æ–¥—É (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)</option>
                        </select>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn-primary">üîç –ù–∞–π—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
                        <button type="reset" class="btn-secondary">–û—á–∏—Å—Ç–∏—Ç—å</button>
                    </div>
                </form>

                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                    <button class="btn-secondary" onclick="toggleReadingList()">üìñ –ú–æ–π —Å–ø–∏—Å–æ–∫ (0)</button>
                    <div id="readingList" style="display: none; margin-top: 15px;">
                        <div id="readingListContent" style="max-height: 300px; overflow-y: auto;">
                            <p style="color: #999; font-size: 0.9em;">–í–∞—à —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div class="results-panel">
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>

                <div id="stats" class="stats" style="display: none;">
                    <div class="stat-item">
                        <div class="stat-value" id="totalBooks">-</div>
                        <div class="stat-label">–ö–Ω–∏–≥ –≤ –±–∞–∑–µ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalGenres">-</div>
                        <div class="stat-label">–ñ–∞–Ω—Ä–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalAuthors">-</div>
                        <div class="stat-label">–ê–≤—Ç–æ—Ä–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalKeywords">-</div>
                        <div class="stat-label">–ö–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤</div>
                    </div>
                </div>

                <div id="resultsContainer">
                    <p style="color: #999; text-align: center; padding: 40px;">
                        üëà –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É —Å–ª–µ–≤–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ù–∞–π—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"
                    </p>
                </div>

                <div id="exportButtons" class="export-buttons" style="display: none;">
                    <button class="btn-primary btn-small" onclick="saveToCSV()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ CSV</button>
                    <button class="btn-secondary btn-small" onclick="shareResults()">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                </div>
            </div>
        </div>

        <!-- –ü–æ–¥–≤–∞–ª -->
        <footer>
            <p>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–Ω–∏–≥ ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python</p>
        </footer>
    </div>

    <script>
        const form = document.getElementById('preferencesForm');
        const resultsContainer = document.getElementById('resultsContainer');
        const exportButtons = document.getElementById('exportButtons');
        const statsPanel = document.getElementById('stats');
        let currentRecommendations = [];
        let readingList = JSON.parse(localStorage.getItem('readingList') || '[]');

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                document.getElementById('totalBooks').textContent = data.total_books;
                document.getElementById('totalGenres').textContent = data.total_genres;
                document.getElementById('totalAuthors').textContent = data.total_authors;
                document.getElementById('totalKeywords').textContent = data.total_keywords;
                statsPanel.style.display = 'grid';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(form);
            const data = {
                genres: formData.get('genres'),
                authors: formData.get('authors'),
                keywords: formData.get('keywords'),
                min_year: formData.get('min_year'),
                sort_by: formData.get('sort_by')
            };

            resultsContainer.innerHTML = '<div class="loading">–ü–æ–∏—Å–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</div>';
            exportButtons.style.display = 'none';

            try {
                const response = await fetch('/api/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (!result.success) {
                    resultsContainer.innerHTML =
                        `<div class="error-message">‚ùå ${result.error}</div>`;
                    return;
                }

                currentRecommendations = result.recommendations;

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                if (currentRecommendations.length === 0) {
                    resultsContainer.innerHTML = `
                        <div class="preference-summary">
                            ${result.preference_summary}
                        </div>
                        <div class="no-results">
                            <div class="no-results-icon">üòï</div>
                            <p>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∫–Ω–∏–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
                            <p style="font-size: 0.9em; margin-top: 10px;">
                                –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </p>
                        </div>
                    `;
                } else {
                    let html = `
                        <div class="preference-summary">
                            ‚ú® ${result.preference_summary}
                        </div>
                        <div class="success-message">
                            ‚úÖ –ù–∞–π–¥–µ–Ω–æ ${result.count} —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
                        </div>
                        <table class="recommendations-table">
                            <thead>
                                <tr>
                                    <th style="width: 5%">#</th>
                                    <th style="width: 25%">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th style="width: 15%">–ê–≤—Ç–æ—Ä</th>
                                    <th style="width: 15%">–ñ–∞–Ω—Ä</th>
                                    <th style="width: 8%">–ì–æ–¥</th>
                                    <th style="width: 10%">–û—Ü–µ–Ω–∫–∞</th>
                                    <th style="width: 22%">–î–µ–π—Å—Ç–≤–∏–µ</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    currentRecommendations.forEach((book, index) => {
                        const inList = readingList.some(b => b.id === book.id);
                        const btnClass = inList ? 'added' : '';
                        const btnText = inList ? '‚úì –í —Å–ø–∏—Å–∫–µ' : '+ –î–æ–±–∞–≤–∏—Ç—å';

                        html += `
                            <tr>
                                <td>${index + 1}</td>
                                <td class="book-title">${book.title}</td>
                                <td>${book.author}</td>
                                <td><span class="genre-badge">${book.genre}</span></td>
                                <td class="year">${book.year}</td>
                                <td class="score">${(book.score * 100).toFixed(0)}%</td>
                                <td>
                                    <button class="reading-list-btn ${btnClass}" 
                                            onclick="toggleReadingListItem(${book.id}, '${book.title}')">
                                        ${btnText}
                                    </button>
                                </td>
                            </tr>
                        `;
                    });

                    html += `
                            </tbody>
                        </table>
                    `;

                    resultsContainer.innerHTML = html;
                    exportButtons.style.display = 'flex';
                }

            } catch (error) {
                resultsContainer.innerHTML =
                    `<div class="error-message">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        });

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å
        function toggleReadingListItem(bookId, title) {
            const index = readingList.findIndex(b => b.id === bookId);

            if (index > -1) {
                readingList.splice(index, 1);
            } else {
                readingList.push({
                    id: bookId,
                    title: title,
                    addedAt: new Date().toISOString()
                });
            }

            localStorage.setItem('readingList', JSON.stringify(readingList));
            updateReadingListButton();

            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            const event = new Event('submit');
            form.dispatchEvent(event);
        }

        function toggleReadingList() {
            const list = document.getElementById('readingList');
            list.style.display = list.style.display === 'none' ? 'block' : 'none';

            if (list.style.display === 'block') {
                updateReadingListContent();
            }
        }

        function updateReadingListButton() {
            const count = readingList.length;
            document.querySelector('button[onclick="toggleReadingList()"]').textContent =
                `üìñ –ú–æ–π —Å–ø–∏—Å–æ–∫ (${count})`;
        }

        function updateReadingListContent() {
            const content = document.getElementById('readingListContent');

            if (readingList.length === 0) {
                content.innerHTML = '<p style="color: #999; font-size: 0.9em;">–í–∞—à —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç</p>';
            } else {
                let html = '<ul style="list-style: none; padding: 0;">';
                readingList.forEach(book => {
                    html += `
                        <li style="padding: 8px; border-bottom: 1px solid #eee;">
                            <div>${book.title}</div>
                            <button onclick="toggleReadingListItem(${book.id}, '${book.title}')"
                                    class="btn-secondary" style="font-size: 0.8em; padding: 4px 8px; width: 100%; margin-top: 5px;">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </li>
                    `;
                });
                html += '</ul>';
                content.innerHTML = html;
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ CSV
        async function saveToCSV() {
            if (currentRecommendations.length === 0) {
                alert('–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                return;
            }

            try {
                const response = await fetch('/api/save-recommendations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ recommendations: currentRecommendations })
                });

                const data = await response.json();

                if (!data.success) {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                    return;
                }

                // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
                const blob = new Blob([data.csv_data], { type: 'text/csv; charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', data.filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + error.message);
            }
        }

        function shareResults() {
            const text = `–Ø –Ω–∞—à–µ–ª ${currentRecommendations.length} –æ—Ç–ª–∏—á–Ω—ã—Ö –∫–Ω–∏–≥ –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ! –ü–æ–ø—Ä–æ–±—É–π —Å–∞–º: ${window.location.href}`;
            if (navigator.share) {
                navigator.share({
                    title: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–Ω–∏–≥',
                    text: text
                });
            } else {
                prompt('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É:', text);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            updateReadingListButton();
        });
    </script>
</body>
</html>
